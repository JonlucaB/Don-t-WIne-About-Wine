{"ast":null,"code":"var internals = require('../internals'),\n    GravityBehavior = require('./behaviors/GravityBehavior'),\n    Rect = require('../geom/Rect'),\n    Vec2D = require('../geom/Vec2D'),\n    id = 0;\n\nvar VerletPhysics2D = function (gravity, numIterations, drag, timeStep) {\n  var opts = {\n    numIterations: 50,\n    drag: 0,\n    timeStep: 1\n  };\n  var a;\n\n  if (arguments.length == 1 && (arguments[0].gravity || arguments[0].numIterations || arguments[0].timeStep || arguments[0].drag)) {\n    //options object literal\n    a = arguments[0];\n    opts.gravity = a.gravity;\n    opts.numIterations = a.numIterations || opts.numIterations;\n    opts.drag = a.drag || opts.drag;\n    opts.timeStep = a.timeStep || opts.timeStep;\n  } else if (arguments.length == 1) {\n    opts.gravity = gravity; //might be Vec2D, will get handled below\n  } else if (arguments.length == 4) {\n    opts.gravity = gravity;\n    opts.numIterations = numIterations;\n    opts.drag = drag;\n    opts.timeStep = timeStep;\n  }\n\n  this.behaviors = [];\n  this.particles = [];\n  this.springs = [];\n  this.numIterations = opts.numIterations;\n  this.timeStep = opts.timeStep;\n  this.setDrag(opts.drag);\n\n  if (opts.gravity) {\n    if (internals.has.XY(opts.gravity)) {\n      opts.gravity = new GravityBehavior(new Vec2D(opts.gravity));\n    }\n\n    this.addBehavior(opts.gravity);\n  }\n\n  this.id = id++;\n};\n\nVerletPhysics2D.addConstraintToAll = function (c, list) {\n  for (var i = 0; i < list.length; i++) {\n    list[i].addConstraint(c);\n  }\n};\n\nVerletPhysics2D.removeConstraintFromAll = function (c, list) {\n  for (var i = 0; i < list.length; i++) {\n    list[i].removeConstraint(c);\n  }\n};\n\nVerletPhysics2D.prototype = {\n  addBehavior: function (behavior) {\n    behavior.configure(this.timeStep);\n    this.behaviors.push(behavior);\n  },\n  addParticle: function (p) {\n    this.particles.push(p);\n    return this;\n  },\n  addSpring: function (s) {\n    if (this.getSpring(s.a, s.b) === undefined) {\n      this.springs.push(s);\n    }\n\n    return this;\n  },\n  clear: function () {\n    this.particles = [];\n    this.springs = [];\n    return this;\n  },\n  constrainToBounds: function () {\n    //protected\n    var p,\n        i = 0,\n        len = this.particles.length;\n\n    for (i = 0; i < len; i++) {\n      p = this.particles[i];\n\n      if (p.bounds !== undefined) {\n        p.constrain(p.bounds);\n      }\n    }\n\n    if (this.worldBounds !== undefined) {\n      for (i = 0; i < len; i++) {\n        p = this.particles[i];\n        p.constrain(this.worldBounds);\n      }\n    }\n  },\n  getCurrentBounds: function () {\n    var min = new Vec2D(Number.MAX_VALUE, Number.MAX_VALUE);\n    var max = new Vec2D(Number.MIN_VALUE, Number.MIN_VALUE);\n    var i = 0,\n        pLen = this.particles.length,\n        p;\n\n    for (; i < pLen; i++) {\n      p = this.particles[i];\n      min.minSelf(p);\n      max.maxSelf(p);\n    }\n\n    return new Rect(min, max);\n  },\n  getDrag: function () {\n    return 1 - this.drag;\n  },\n  getNumIterations: function () {\n    return this.numIterations;\n  },\n  getSpring: function (a, b) {\n    var i = 0,\n        sLen = this.springs.length;\n\n    for (; i < sLen; i++) {\n      var s = this.springs[i];\n\n      if (s.a === a && s.b === b || s.a === b && s.b === b) {\n        return s;\n      }\n    }\n\n    return undefined;\n  },\n  getTimeStep: function () {\n    return this.timeStep;\n  },\n  getWorldBounds: function () {\n    return this.worldBounds;\n  },\n  removeBehavior: function (c) {\n    return internals.removeItemFrom(c, this.behaviors);\n  },\n  removeParticle: function (p) {\n    return internals.removeItemFrom(p, this.particles);\n  },\n  removeSpring: function (s) {\n    return internals.removeItemFrom(s, this.springs);\n  },\n  removeSpringElements: function (s) {\n    if (this.removeSpring(s) !== undefined) {\n      return this.removeParticle(s.a) && this.removeParticle(s.b);\n    }\n\n    return false;\n  },\n  setDrag: function (drag) {\n    this.drag = 1 - drag;\n  },\n  setNumIterations: function (numIterations) {\n    this.numIterations = numIterations;\n  },\n  setTimeStep: function (timeStep) {\n    this.timeStep = timeStep;\n    var i = 0,\n        l = this.behaviors.length;\n\n    for (; i < l; i++) {\n      this.behaviors[i].configure(timeStep);\n    }\n  },\n  setWorldBounds: function (world) {\n    this.worldBounds = world;\n    return this;\n  },\n  update: function () {\n    this.updateParticles();\n    this.updateSprings();\n    this.constrainToBounds();\n    return this;\n  },\n  updateParticles: function () {\n    var i = 0,\n        j = 0,\n        bLen = this.behaviors.length,\n        pLen = this.particles.length,\n        b,\n        p;\n\n    for (; i < bLen; i++) {\n      b = this.behaviors[i];\n\n      for (j = 0; j < pLen; j++) {\n        b.applyBehavior(this.particles[j]);\n      }\n    }\n\n    for (j = 0; j < pLen; j++) {\n      p = this.particles[j];\n      p.scaleVelocity(this.drag);\n      p.update();\n    }\n  },\n  updateSprings: function () {\n    var i = this.numIterations,\n        sLen = this.springs.length,\n        j = 0;\n\n    for (; i > 0; i--) {\n      for (j = 0; j < sLen; j++) {\n        this.springs[j].update(i === 1);\n      }\n    }\n  }\n};\nmodule.exports = VerletPhysics2D;","map":{"version":3,"sources":["C:/Users/alfor/Documents/GitHub/Don-t-WIne-About-Wine/node_modules/toxiclibsjs/physics2d/VerletPhysics2D.js"],"names":["internals","require","GravityBehavior","Rect","Vec2D","id","VerletPhysics2D","gravity","numIterations","drag","timeStep","opts","a","arguments","length","behaviors","particles","springs","setDrag","has","XY","addBehavior","addConstraintToAll","c","list","i","addConstraint","removeConstraintFromAll","removeConstraint","prototype","behavior","configure","push","addParticle","p","addSpring","s","getSpring","b","undefined","clear","constrainToBounds","len","bounds","constrain","worldBounds","getCurrentBounds","min","Number","MAX_VALUE","max","MIN_VALUE","pLen","minSelf","maxSelf","getDrag","getNumIterations","sLen","getTimeStep","getWorldBounds","removeBehavior","removeItemFrom","removeParticle","removeSpring","removeSpringElements","setNumIterations","setTimeStep","l","setWorldBounds","world","update","updateParticles","updateSprings","j","bLen","applyBehavior","scaleVelocity","module","exports"],"mappings":"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","sourcesContent":["\n\n    var internals = require('../internals'),\n        GravityBehavior = require('./behaviors/GravityBehavior'),\n        Rect = require('../geom/Rect'),\n        Vec2D = require('../geom/Vec2D'),\n        id = 0;\n\n    var VerletPhysics2D = function(gravity, numIterations, drag, timeStep) {\n        var opts = {\n            numIterations: 50,\n            drag: 0,\n            timeStep: 1\n        };\n        var a;\n        if( arguments.length == 1 && (arguments[0].gravity || arguments[0].numIterations || arguments[0].timeStep || arguments[0].drag) ){ //options object literal\n            a = arguments[0];\n            opts.gravity = a.gravity;\n            opts.numIterations = a.numIterations || opts.numIterations;\n            opts.drag = a.drag || opts.drag;\n            opts.timeStep = a.timeStep || opts.timeStep;\n        } else if( arguments.length == 1){\n            opts.gravity = gravity; //might be Vec2D, will get handled below\n        } else if( arguments.length == 4 ){\n            opts.gravity = gravity;\n            opts.numIterations = numIterations;\n            opts.drag = drag;\n            opts.timeStep = timeStep;\n        }\n\n        this.behaviors = [];\n        this.particles = [];\n        this.springs = [];\n        this.numIterations = opts.numIterations;\n        this.timeStep = opts.timeStep;\n        this.setDrag(opts.drag);\n        if( opts.gravity ){\n            if( internals.has.XY( opts.gravity ) ){\n                opts.gravity = new GravityBehavior( new Vec2D(opts.gravity) );\n            }\n            this.addBehavior( opts.gravity );\n        }\n        this.id = id++;\n    };\n\n    VerletPhysics2D.addConstraintToAll = function(c, list){\n        for(var i=0;i<list.length;i++){\n            list[i].addConstraint(c);\n        }\n    };\n\n    VerletPhysics2D.removeConstraintFromAll = function(c,list){\n        for(var i=0;i<list.length;i++){\n            list[i].removeConstraint(c);\n        }\n    };\n\n    VerletPhysics2D.prototype = {\n\n        addBehavior: function(behavior){\n            behavior.configure(this.timeStep);\n            this.behaviors.push(behavior);\n        },\n\n        addParticle: function(p){\n            this.particles.push(p);\n            return this;\n        },\n\n        addSpring: function(s){\n            if(this.getSpring(s.a,s.b) === undefined){\n                this.springs.push(s);\n            }\n            return this;\n        },\n\n        clear: function(){\n            this.particles = [];\n            this.springs = [];\n            return this;\n        },\n\n        constrainToBounds: function(){ //protected\n            var p,\n                i = 0,\n                len = this.particles.length;\n            for(i=0; i<len; i++){\n                p = this.particles[i];\n                if(p.bounds !== undefined){\n                    p.constrain(p.bounds);\n                }\n            }\n            if(this.worldBounds !== undefined){\n                for(i=0; i<len; i++){\n                    p = this.particles[i];\n                    p.constrain(this.worldBounds);\n                }\n            }\n        },\n\n        getCurrentBounds: function(){\n            var min = new Vec2D(Number.MAX_VALUE, Number.MAX_VALUE);\n            var max = new Vec2D(Number.MIN_VALUE, Number.MIN_VALUE);\n            var i = 0,\n                pLen = this.particles.length,\n                p;\n            for(; i<pLen; i++){\n                p = this.particles[i];\n                min.minSelf(p);\n                max.maxSelf(p);\n            }\n            return new Rect(min,max);\n        },\n\n        getDrag: function() {\n            return 1 - this.drag;\n        },\n\n        getNumIterations: function(){\n            return this.numIterations;\n        },\n\n        getSpring: function(a,b){\n            var i = 0,\n                sLen = this.springs.length;\n            for(; i<sLen; i++){\n                var s = this.springs[i];\n                if((s.a === a && s.b === b) || (s.a === b && s.b === b)){\n                    return s;\n                }\n            }\n            return undefined;\n        },\n\n        getTimeStep: function(){\n            return this.timeStep;\n        },\n\n        getWorldBounds: function(){\n            return this.worldBounds;\n        },\n\n        removeBehavior: function(c){\n            return internals.removeItemFrom(c,this.behaviors);\n        },\n\n        removeParticle: function(p){\n            return internals.removeItemFrom(p,this.particles);\n        },\n\n        removeSpring: function(s) {\n            return internals.removeItemFrom(s,this.springs);\n        },\n\n        removeSpringElements: function(s){\n            if(this.removeSpring(s) !== undefined){\n                return (this.removeParticle(s.a) && this.removeParticle(s.b));\n            }\n            return false;\n        },\n\n        setDrag: function(drag){\n            this.drag = 1 - drag;\n        },\n\n        setNumIterations: function(numIterations){\n            this.numIterations = numIterations;\n        },\n\n        setTimeStep: function(timeStep){\n            this.timeStep = timeStep;\n            var i =0, l = this.behaviors.length;\n            for(; i<l; i++){\n                this.behaviors[i].configure(timeStep);\n            }\n        },\n\n        setWorldBounds: function(world){\n            this.worldBounds = world;\n            return this;\n        },\n\n        update: function(){\n            this.updateParticles();\n            this.updateSprings();\n            this.constrainToBounds();\n            return this;\n        },\n\n        updateParticles: function(){\n            var i = 0,\n                j = 0,\n                bLen = this.behaviors.length,\n                pLen = this.particles.length,\n                b,\n                p;\n            for(; i<bLen; i++){\n                b = this.behaviors[i];\n                for(j = 0; j<pLen; j++){\n                    b.applyBehavior(this.particles[j]);\n                }\n            }\n            for(j = 0; j<pLen; j++){\n                p = this.particles[j];\n                p.scaleVelocity(this.drag);\n                p.update();\n            }\n        },\n\n        updateSprings: function(){\n            var i = this.numIterations,\n                sLen = this.springs.length,\n                j = 0;\n            for(; i > 0; i--){\n                for(j = 0; j<sLen; j++){\n                    this.springs[j].update(i === 1);\n                }\n            }\n        }\n    };\n\n    module.exports = VerletPhysics2D;\n\n"]},"metadata":{},"sourceType":"script"}